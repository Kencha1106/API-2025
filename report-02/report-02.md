
##  API実習　2025　課題レポート（第2回）修正版

  
###  出題範囲：　API実習2025　第4回～第6回まで

###  提出期限：　2025/12/15(月) 17:00

|20124001|會田健生|

## 出題範囲
- **API実習(4)**：レスポンスデータ設計、JSON/JSONP、フォーマット指定、セキュリティ（XSS, CSRF）、Same-Origin Policy、CORS
- **API実習(5)**：レスポンス項目命名規則、エラー設計、HTTPステータスコード、日付フォーマット、識別子設計
- **API実習(6)**：HTTP仕様、キャッシュ制御、メディアタイプ、コンテンツネゴシエーション、ステータスコード詳細


## 提出形式
- 各問に対して **400～600字程度の解答**を記述
- 図や表を用いる場合はMarkdown記法で挿入



## 課題一覧

### 問1：HTTPステータスコードの分類と役割
HTTPステータスコードは100番台から500番台まで分類されています。それぞれのカテゴリ（情報、成功、リダイレクト、クライアントエラー、サーバエラー）について、**代表的なコードと意味を3つずつ挙げ、API設計でどのような場面で使うか具体例を示してください**。

---
一つは200 OK、リクエストが成功した時に帰ってくる通常のレスポンスを表している。設計での具体例はGET/usersでユーザー一覧を返すときに利用される。
一つは301 Moved Permanently、URLを永続的に新しいものへ移動させるときに帰ってくるもの。設計での具体例はAPIのバージョンを古いエンドポイントから新しいものに変え誘導するときに利用される。
一つは400 Bad Request、指定したリソースが見つからない場合に帰ってくるもの。設計での具体例は間違ったJSON構造をしているときに帰ってくる。

### 問2：JSONとXMLの比較
WebAPIのレスポンス形式としてJSONが主流になった理由を、**XMLとの比較で3つ以上挙げて説明してください**。また、**JSONPの仕組みと利用目的、セキュリティ上の問題点を簡潔にまとめてください**。

---
・軽量性・シンプルさ
・JavaScriptとの親和性
・可読性・扱いやすさ
- JavaScriptの script タグで外部ドメインからデータを取得する仕組みのこと。利用目的はクロスドメイン通信を可能にするため。セキュリティ上の問題点は、任意のJSのコードが実行されるためXSS（クロスサイトスクリプティング）攻撃のリスクが常に存在すること。


### 問3（実演）：PostmanでSheetDB APIにGETリクエスト
- 無償で利用できるSheetDBの公開エンドポイントを使い、Postmanで`GET`リクエストを送信してください。
- **操作手順**：
  1. Postmanを起動し、新規リクエストを作成
  2. メソッドを`GET`に設定
  3. URLに以下を入力：`https://sheetdb.io/api/v1/58f61be4dda40`
  4. Sendをクリック
- **報告内容**：
  - ステータスコード
  - レスポンスヘッダ（`Content-Type`など）
  - レスポンスJSONのスクリーンショット
ステータスコード：200 OK
レスポンスヘッダ：Content-Type: application/json;
<img width="1912" height="999" alt="image-1" src="https://github.com/user-attachments/assets/fd131a7d-2d42-4a10-8ea4-360cc068366b" />

---

### 問4：キャッシュ制御の仕組み
HTTPキャッシュの2つのモデル（Expiration ModelとValidation Model）について、**仕組みと利用シーンを説明してください**。また、以下のヘッダの意味を答えてください。
```
Cache-Control: max-age=3600
Expires: Tue, 14 Dec 2021 00:00:00 JST
ETag: "abc123"
```
・Cache-Control: max-age=3600
→ レスポンスは取得後 3600秒（1時間） の間は有効。ブラウザはその間サーバーに問い合わせずキャッシュを使う。
・Expires: Tue, 14 Dec 2021 00:00:00 JST
→ レスポンスの有効期限を絶対日時で指定。上記日時を過ぎるとキャッシュは期限切れとなる
・ETag: "abc123"
→ リソースの「バージョン識別子」を表す。キャッシュが期限切れになったとき、ブラウザは If-None-Match: "abc123" を送信し、サーバーが同じETagなら「変更なし」として304を返す。

---

### 問5（実演）：レスポンスJSONの分析
- 問3で取得したレスポンスJSONを分析し、**キーの命名規則（キャメルケース、スネークケースなど）と構造の特徴をまとめてください**。
- **報告内容**：
  - 実際のレスポンス例：
  [
    {
        "id": "1",
        "name": "Tom",
        "age": "15",
        "comment": ""
    },
    {
        "id": "2",
        "name": "Alex",
        "age": "24",
        "comment": ""
    },
    {
        "id": "3",
        "name": "John",
        "age": "51",
        "comment": ""
    },
    {
        "id": "4",
        "name": "Steve",
        "age": "22",
        "comment": "special"
    },
    {
        "id": "5",
        "name": "James",
        "age": "19",
        "comment": ""
    }
]
・命名規則の評価：idやnameなどはすべてローワーキャメルケースで表されている。また、スタイルの統一からなる一貫性もある。
・構造の特徴：commentの使用により空白でもレスポンスが変えるため、柔軟性のある構造だといえる。
・改善提案：上記でも問題はないがnullが帰ってくるほうが未入力、空白の区別ができて便利ではないか。

---

### 問6：エラー設計と詳細情報
APIでエラーが発生した場合、HTTPステータスコードだけでなく詳細情報を返すことが推奨されます。**以下の観点でエラー情報設計のポイントをまとめてください**。
- 開発者向けメッセージと利用者向けメッセージの違い
- エラー原因の分類（例：認証、権限、リソース不在）
- ドキュメントURLの付与の意義

---
・開発者向けメッセージ → 技術的詳細、デバッグ用
・利用者向けメッセージ → 簡潔で行動指針を示す
・ドキュメントURL → エラー理解と解決を促進し、開発者体験を向上

### 問7：日付フォーマットと国際化
APIレスポンスで日付を扱う場合、RFC 3339（ISO8601）形式が推奨されます。**以下の3つのフォーマットの違いを説明し、どの形式を採用すべきか理由を述べてください**。
- `Sun, 05 Dec 2021 07:57:37 GMT`（RFC 1123）
- `2021-12-05T12:34:56+09:00`（RFC 3339）
- `Sun Dec 5 12:34:56 2021`（asctime形式）

RFC3339形式の採用が良いと思う
理由＝機械可読性が他と比べて高く、APIクライアントの確実なパースが可能になる。

---

### 問8（実演）：Acceptヘッダの実験
- Postmanで`Accept`ヘッダを`application/json`と`text/html`に変えてSheetDB APIにリクエストし、レスポンスの違いを確認してください。
- **報告内容**：
  - それぞれのレスポンスのスクリーンショット
  - 違いの説明

---<img width="1919" height="936" alt="image" src="https://github.com/user-attachments/assets/efca3776-af64-4a74-a529-9019a3dd8cca" />

<img width="1918" height="944" alt="image" src="https://github.com/user-attachments/assets/262d312f-5288-4875-b7d1-b58bfb94c0a7" />

違いの説明:
同じデータであるが機械向けの処理であるか、人がブラウザでの閲覧がしやすい表示になるかの違いであると思う。
・application/jsonの場合レスポンスの形式がJSON形式になる。・・text/htmlの場合、レスポンスはHTML方式に帰ってくる。

・

### 問9：セキュリティ対策（XSS・CSRF）
WebAPI利用時に発生しうるXSSとCSRF攻撃について、**攻撃の仕組みと被害例を説明し、それぞれの対策を3つずつ挙げてください**。また、**Same-Origin PolicyとCORSの関係を簡潔にまとめてください**。

XXS:攻撃の仕組み
・攻撃者が悪意ある JavaScriptコード をWebページやAPIレスポンスに埋め込み、利用者のブラウザで実行させる。
・ユーザー入力を適切にエスケープせずに表示すると発生。
被害例
・ユーザーの Cookieや認証情報の盗難
・偽フォームによる フィッシング
・DOM改ざんによる 不正操作や画面書き換え
対策
・入力値のサニタイズ・エスケープ
→ HTML、JavaScript、JSONに応じて適切にエスケープ。
・Content Security Policy (CSP) の導入
→ 外部スクリプトの読み込み制限、インラインスクリプト禁止。
・出力時のコンテキスト依存エスケープ
→ HTML属性、URL、JavaScript内など利用場所に応じたエスケープ処理。

CSRF：攻撃の仕組み
・ユーザーが認証済み状態で、攻撃者が用意したページから 不正なリクエスト を送信させる。
・ブラウザが自動的にCookieを送信する仕組みを悪用。
被害例
・ユーザーが意図せず 商品購入や送金 を行わされる
・アカウント設定変更（メールアドレス変更、パスワードリセット）
・権限のない操作が実行される
対策（3つ）
・CSRFトークンの利用
→ フォームやAPIリクエストにランダムなトークンを付与し、検証。
・SameSite Cookie 属性の設定
→ クロスサイトからのCookie送信を制限。
・重要操作は再認証や二段階確認
→ 送金や設定変更時にパスワード再入力やワンタイムコードを要求。

---

### 問10：コンテンツネゴシエーション
HTTPのコンテンツネゴシエーションにおいて、**Acceptヘッダとq値（品質値）の役割を説明し、以下の例でサーバがどのメディアタイプを選択するか理由を述べてください**。
```
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
```
・Acceptヘッダはクライアントが受け入れ可能なメディアタイプを宣言している。
・q値(品質値)は優先度を指定している（1.0が最優先）。
・例のケースにおいて、サーバは text/html と思う。application/xhtml+xml や image/webp も優先度は同じであるが、通常はHTMLが選ばれる。
